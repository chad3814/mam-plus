// ==UserScript==
// @name         MAM Plus Dev
// @namespace    https://greasyfork.org/en/users/36444
// @version      3.0.0
// @description  Lots of tiny fixes for MAM
// @author       GardenShade
// @include      https://myanonamouse.net/*
// @include      https://www.myanonamouse.net/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_listValues
// @grant        GM_deleteValue
// @grant        GM_addStyle
// @grant        GM_info
// ==/UserScript==
var MP_DEBUG=!0;try{var MP_CHECK;MP_CHECK={version:function(){var e,o,n;e=function(e){return e=e.split("."),e[0]+"."+e[1]},n=e(MP.PREV_VER),o=e(MP.VERSION),!0===MP_DEBUG&&(o=Math.random(),console.group("MP_CHECK.version()"),console.log("PREV_VER: "+MP.PREV_VER+" ("+n+")"),console.log("VERSION: "+MP.VERSION+" ("+o+")")),n!==o&&(!0===MP_DEBUG&&console.log("Dif versions; making notification..."),null!=n?(!0===MP_DEBUG&&console.log("mp_alerts: "+GM_getValue("mp_alerts")),!0===GM_getValue("mp_alerts")&&MP_HELPERS.triggerNote("update")):(GM_setValue("mp_gr_btns",!0),GM_setValue("mp_alerts",!0),MP_HELPERS.triggerNote("firstRun")),GM_setValue("mp_version",MP.VERSION),!0===MP_DEBUG&&console.groupEnd())},page:function(e){switch(MP_PAGE.global(),e.split("/")[1]){case null:break;case"":MP_PAGE.home();break;case"shoutbox":MP_PAGE.shoutbox();break;case"tor":0===pagePath.split("/")[2].indexOf("browse")&&MP_PAGE.browse("browse"),0===pagePath.split("/")[2].indexOf("request")&&MP_PAGE.browse("requests");break;case"t":MP_PAGE.torrent();break;case"preferences":MP_PAGE.settings();break;case"u":MP_PAGE.user();break;case"millionaires":0===pagePath.split("/")[2].indexOf("pot")&&MP_PAGE.vault("pot"),0===pagePath.split("/")[2].indexOf("donate")&&MP_PAGE.vault("donate")}}};var MP_HELPERS;MP_HELPERS={timestamp:function(){var e;return e=(new Date).toUTCString().split(" "),e[2]+" "+e[1]},triggerNote:function(e){var o,n,t;if(!0===MP_DEBUG&&(console.group("MP_HELPERS.triggerNote()"),console.log("Note type is "+e)),o=function(e,o){var t,r,s;if(!0===MP_DEBUG&&console.log("buildMsg("+o+")"),e.length>0&&""!==e[0]){for(n+="<h4>"+o+":</h4><ul>",t=0,s=e.length;t<s;t++)r=e[t],n+="<li>"+r+"</li>";n+="</ul>"}},t=function(e){var o,n,t;!0===MP_DEBUG&&console.log("showPanel()"),document.body.innerHTML+="<div class='mp_notification'>"+e+"<span>X</span></div>",t=document.querySelector(".mp_notification"),o=t.querySelector("span");try{return o.addEventListener("click",function(){return t.remove()},!1)}catch(e){return n=e,!0===MP_DEBUG&&console.warn(n),!1}},n="","update"===e?(!0===MP_DEBUG&&console.log("update confirmed"),n+="<strong>MAM+ has been updated!</strong> You are now using v"+MP.VERSION+", published on "+MP.TIMESTAMP+". Discuss it on <a href='forums.php?action=viewtopic&topicid=41863'>the forums</a>.<hr>",o(MP.UPDATE_LIST,"Changes"),o(MP.BUG_LIST,"New Bugs")):"firstRun"===e&&(!0===MP_DEBUG&&console.log("firstRun confirmed"),n+='<h4>Welcome to MAM+!</h4>Please head over to your <a href="/preferences/index.php">preferences</a> to enable the MAM+ settings.<br>Any bug reports, feature requests, etc. can be made on <a href="/forums.php?action=viewtopic&topicid=41863">the forums</a> or <a href="/sendmessage.php?receiver=108303">through private message</a>.'),t(n),!0===MP_DEBUG)return console.groupEnd()}};var MP_PAGE;MP_PAGE={global:function(){return console.log("global")},home:function(){return console.log("home")},shoutbox:function(){return console.log("shoutbox")},browse:function(e){return console.log("browse",e)},torrent:function(){return console.log("torrent")},settings:function(){return console.log("settings")},user:function(){return console.log("user")},vault:function(e){return console.log("vault",e)}};var MP_STYLE;MP_STYLE={setStyle:function(){var e;return e=document.querySelector('head link[href*="ICGstation"]').getAttribute("href"),e.indexOf("dark")>0&&(this.theme="dark",this.btnBorder="1px solid #bbaa77",this.btnColor="#aaa"),GM_addStyle(".mp_notification{\n    position: fixed;\n    padding: 20px 40px;\n    width: 100%;\n    bottom:0;\n    left:0;\n    background: #333;\n    color: #bbb;\n    box-shadow: 0 0 4px 0 rgba(0,0,0,0.3);\n    z-index: 99998;\n}\n.mp_notification span{\n    position: absolute;\n    padding: 5px 10px;\n    display: inline-block;\n    top: -10px;\n    right: 90px;\n    background: #333;\n    color: red;\n    box-shadow: 0 0 4px 0 rgba(0,0,0,0.3);\n    border-radius: 50px;\n    cursor: pointer;\n    z-index: 99999;\n}"),this.theme},theme:"light",btnBorder:"1px solid #d0d0d0",btnColor:"#000"};var MP;MP={VERSION:GM_info.script.version,PREV_VER:GM_getValue("mp_version"),TIMESTAMP:"Apr 17th",UPDATE_LIST:["Completely rewrote backend for <em>n</em>th time","Improved error handling"],BUG_LIST:[],errorLog:[],pagePath:window.location.pathname,run:function(){return console.group("Welcome to MAM+ v"+this.VERSION+"!"),MP_STYLE.setStyle(),console.log("Theme is "+MP_STYLE.theme),MP_CHECK.version(),MP_CHECK.page(this.pagePath),console.groupEnd()}},MP.run()}catch(e){MP_DEBUG&&console.warn(e)}